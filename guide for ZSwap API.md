1. Introduction to ZSwap API
ZSwap is the privacy-focused transaction layer in the Midnight Network ecosystem. It enables private transactions between users and contracts while maintaining privacy guarantees. The ZSwap API provides TypeScript interfaces for creating, managing, and submitting private transactions on the Midnight Network.
2. Key Concepts
Network ID
Before any interaction with the ZSwap API, you must set the NetworkId to target the correct network:
;
Proof Stages
Transactions in ZSwap exist in one of three stages:
Unproven (e.g., UnprovenTransaction): The initial stage for all transaction components
Proven (e.g., Transaction): Transactions with cryptographic proofs generated by the proof server
ProofErased (e.g., ProofErasedTransaction): Used for testing when proofs aren't necessary
;
Transaction Structure
A ZSwap transaction consists of:
A "guaranteed" Offer (handles fee payments and fast-to-verify operations)
An optional "fallible" Offer (operations that may fail atomically)
Contract call information
3. ZSwap Offers
A ZSwap Offer is the core component of a transaction and includes:
Inputs: Coin objects being spent (burned)
Outputs: New coins being created
Transients: Temporary coins created and spent in the same transaction
TokenType balance mappings: Track token inflows/outflows
;
Working with Inputs and Outputs
Inputs can be created from:
A QualifiedCoinInfo and contract address (for contract-owned coins)
A QualifiedCoinInfo and ZswapLocalState (for user-owned coins)
Outputs can be created from:
A CoinInfo and contract address (for contract-owned coins)
A CoinInfo and user public key(s) (for user-owned coins)
;
4. State Management
ZSwap uses two primary state structures:
ZswapChainState
Represents the on-chain state of ZSwap, including:
The Merkle tree of coin commitments
Transaction history
Network parameters
ZswapLocalState (LocalState)
Contains a user's wallet state, including:
Owned coins
Spending keys
Transaction history
;
5. Wallet Provider Structure
A proper wallet provider for ZSwap integration should include:
;
6. Working with CoinInfo
CoinInfo represents a coin in the ZSwap system with:
TokenType: Identifies the token (e.g., native MIDNIGHT token)
Value: The amount of the token
Nonce: Ensures coin uniqueness
;
7. Transaction Creation and Deployment Workflow
Here's the typical workflow for contract deployment:
Setup providers:
;
Create contract instance:
;
Deploy the contract:
;
8. Error Handling
When working with ZSwap, common errors include:
Missing ZSwap local state: Ensure the zswapLocalState property includes both bytes and coins
Coin encoding errors: Check that public keys are properly formatted (usually hex strings)
Merkle tree errors: Ensure the local state contains valid coin commitments
9. Testing and Development
For testing, you can use:
eraseProof() methods to bypass proof requirements
sampleCoinPublicKey(), sampleTokenType(), etc. for test data
LedgerParameters.dummyParameters() for test networks
Conclusion
The ZSwap API provides a powerful interface for working with private transactions in the Midnight Network. By understanding the core concepts of transaction creation, state management, and proper provider configuration, you can build privacy-preserving applications on Midnight.
When troubleshooting deployment issues, focus on the wallet provider configuration, especially the ZSwap local state structure, as this is often the source of errors in the deployment process.